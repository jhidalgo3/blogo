<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Applying AOP on IQueryables</title>
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="/#" class="brand">machadogj</a>
          <ul class="nav">
            <li class=""><a href="/#">Home</a></li>
            <li class=""><a href="/about.html">About</a></li>
          </ul>
          <ul class="nav pull-right">
            <li>
              <form action="/search.html" method="get" class="navbar-search pull-left">
                <input name="q" type="text" placeholder="Search" class="search-query">
              </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <article class="span8">
          <header>
            <h1>Applying AOP on IQueryables</h1>
            <div>
              <address class="author">by<span> machadogj</span><br>on 
                <time datetime="2010-05-05T17:49" pubdate>05.05.2010 17:49</time>
              </address>
            </div>
          </header>
          <div class="content">When working with LinqToSql or Entity Framework, you will be using IQueryables extensibly. So extensibly, that plenty of your code will be employed in writting Where clauses in Linq. Linq makes it very easy and declarative to ask for whatever you need. The problem araises when you have complex where clauses and the same conditions all over your repository. For example, suppose your records have a DateDeleted column, which means that the record has been deleted when it is not null (e =&gt; e.DateDeleted != null). You could have that condition all over the place. And a similar thing would happen if you had a IsActive, or Status columns. The proposed solution is very simple, we use method extensions in order to add the most common conditions to the IQueryable&lt;T&gt;. Something like this: public static IQueryable&lt;Order&gt; ThatAreShipped(this IQueryable&lt;Order&gt; query)
{
return query.Where(o =&gt; o.Status == OrderStatus.Shipped);
}
or
public static IQueryable&lt;Order&gt; WhereIdIs(this IQueryable&lt;Order&gt; query, int id)
{
return query.Where(o =&gt; o.Id == id);
} So you can see a simple pattern, when the condition requires parameters, we use the prefix "Where", and when the condition doesn't require a parameter, then we use the prefix "That". So we could see something like the following and easily understand what we will get in return: var orders = context.Orders.ThatAreShipped().WhereTotalGreaterThan(100).WhereShippingStateIs("NY"); The basic AOP concept we are avoiding here is to have similar code Scattered all over our repository. It turns out that method extensions, are an excellent and easy way to apply AOP. If you use the namespace of these extensions to be internal to the repository, then you will see this methods in the repository only. So if you do the following from outside the repository namespace: var orders = new List&lt;Order&gt;().AsQueryable().ThatAreShipped() This would throw a compilation error, and that is perfect, because it is a repository concern only.</div>
        </article>
        <div class="span4">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Latest Posts</li>
              <li><a href="/2012/4/stylus-a-better-css.html">Stylus, a better CSS</a></li>
              <li><a href="/2012/4/getting-started-with-express-for-node-js.html">Getting started with Express for node.js</a></li>
              <li><a href="/2012/4/getting-started-with-node-js.html">Getting started with node.js</a></li>
              <li><a href="/2012/0/unit-testing-and-test-driven-development-lessons-learned.html">Unit Testing and Test Driven Development (Lessons Learned)</a></li>
              <li><a href="/2011/9/unit-testing-wit-knockout-js-with-tdd.html">Unit Testing with Knockout.js</a></li>
              <li><a href="/archive.html">See more >></a></li>
            </ul>
          </div>
        </div>
      </div>
      <hr>copyright 2012 <a href="http://machadogj.com">machadogj.com</a> by <a href="http://twitter.com/machadogj">@machadogj</a><br><br>
    </div>
    <script src="/js/bootstrap.js"></script>
  </body>
</html>