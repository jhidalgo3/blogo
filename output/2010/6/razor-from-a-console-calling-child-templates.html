<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Razor from a console - calling child templates</title>
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="/#" class="brand">machadogj</a>
          <ul class="nav">
            <li class=""><a href="/#">Home</a></li>
            <li class=""><a href="/about.html">About</a></li>
          </ul>
          <ul class="nav pull-right">
            <li>
              <form action="/search.html" method="get" class="navbar-search pull-left">
                <input name="q" type="text" placeholder="Search" class="search-query">
              </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <article class="span8">
          <header>
            <h1>Razor from a console - calling child templates</h1>
            <div>
              <address class="author">by<span> machadogj</span><br>on 
                <time datetime="2010-07-16T11:09" pubdate>16.07.2010 11:09</time>
              </address>
            </div>
          </header>
          <div class="content">In my previous <a href="/2010/07/07/using-razor-from-a-console-application/">post</a> I showed how to run a Razor template (.NET's new view engine) from a console app in order to generate code. In this post I will demostrate how to run another razor template from within a razor template. This is actually quiet simple, and since we already have the "RazorClient.dll" referenced in the RazorFactory code, we can achieve this with the following code (this goes inside a razor template): Snippet
<pre>@{ var factory = new RazorClient.RazorFactory(); using (var template = factory.Create&lt;RazorClient.FileWriter&gt;(@"C:UsersGusDocumentsVisual Studio 2010ProjectsConsoleApplication1ConsoleApplication1Test2.txt")) { if(factory.Errors.Length &gt; 0) { //do something } else { template.FilePath = @"C:UsersGusDocumentsVisual Studio 2010ProjectsConsoleApplication1ConsoleApplication1Test2.txt.out.txt"; template.Execute(); } }
}
</pre>
Notice how we need to include the namespace of the classes like in RazorClient.RazorFactory. This code being so easy led me to the idea of having a main razor file to act as a project and fire the rest of the templates. And I took advantage of the fact that we are firing the rest of the templates from a Razor file to generate a report that showed the status of each template in HTML format. Here is a sample: Snippet
<pre>&lt;html&gt;
&lt;head&gt; &lt;style type="text/css"&gt; .success { background-color: green; } .failed { color: white; background-color: red; } &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;My project name here&lt;/h1&gt;
&lt;p&gt;
Project generated on @DateTime.Now
&lt;/p&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;Template&lt;/td&gt;
&lt;td&gt;Status&lt;/td&gt;
&lt;td&gt;Errors&lt;/td&gt;
&lt;/tr&gt; &lt;tr&gt;
&lt;td&gt;Test2.cshtml&lt;/td&gt;
@{ try { //this is my block code. var factory = new RazorClient.RazorFactory(); using (var template = factory.Create&lt;RazorClient.FileWriter&gt;(@"C:UsersGusDocumentsVisual Studio 2010ProjectsConsoleApplication1ConsoleApplication1Test2.txt")) { if(factory.Errors.Length &gt; 0) { this.Write("&lt;td class='failed'&gt;Failed&lt;/td&gt;"); this.Write("&lt;td&gt;"); foreach(var t in factory.Errors) { this.Write(t); this.Write("&lt;br /&gt;"); } this.Write("&lt;/td&gt;"); } else { template.FilePath = @"C:UsersGusDocumentsVisual Studio 2010ProjectsConsoleApplication1ConsoleApplication1Test2.txt.out.txt"; template.Execute(); this.Write("&lt;td class='success'&gt;Successful&lt;/td&gt;&lt;td&gt;&lt;/td&gt;"); } } } catch(Exception ex) { this.Write("&lt;td class='failed'&gt;Failed&lt;/td&gt;"); this.Write("&lt;td&gt;"); this.Write(ex.ToString()); this.Write("&lt;/td&gt;"); }
}
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
When I ran this main template, the following html was generated (you might want to tune it up a little, html design is not my thing :)):
<h1>My project name</h1>
Project generated on 7/16/2010 10:44:33 AM
<table>
<tbody>
<tr>
<td>Template</td>
<td>Status</td>
<td>Errors</td>
</tr>
<tr>
<td>Test2.txt</td>
<td>Successful</td>
<td></td>
</tr>
</tbody>
</table>
So in this post I showed that having a main template to fire the rest of the child templates is a good idea.</div>
        </article>
        <div class="span4">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Latest Posts</li>
              <li><a href="/2012/4/stylus-a-better-css.html">Stylus, a better CSS</a></li>
              <li><a href="/2012/4/getting-started-with-express-for-node-js.html">Getting started with Express for node.js</a></li>
              <li><a href="/2012/4/getting-started-with-node-js.html">Getting started with node.js</a></li>
              <li><a href="/2012/0/unit-testing-and-test-driven-development-lessons-learned.html">Unit Testing and Test Driven Development (Lessons Learned)</a></li>
              <li><a href="/2011/9/unit-testing-wit-knockout-js-with-tdd.html">Unit Testing with Knockout.js</a></li>
              <li><a href="/archive.html">See more >></a></li>
            </ul>
          </div>
        </div>
      </div>
      <hr>copyright 2012 <a href="http://machadogj.com">machadogj.com</a> by <a href="http://twitter.com/machadogj">@machadogj</a><br><br>
    </div>
    <script src="/js/bootstrap.js"></script>
  </body>
</html>