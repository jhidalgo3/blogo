<!DOCTYPE html>
<html lang="es">
  <head>
    <title>REST services with MVC</title>
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a data-toggle="collapse" data-target=".nav-collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a><a href="/#" class="brand">machadogj</a>
          <ul class="nav">
            <li class=""><a href="/#">Home</a></li>
            <li class=""><a href="/about.html">About</a></li>
          </ul>
          <ul class="nav pull-right">
            <li>
              <form action="/search.html" method="get" class="navbar-search pull-left">
                <input name="q" type="text" placeholder="Search" class="search-query">
              </form>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <article class="span8">
          <header>
            <h1>REST services with MVC</h1>
            <div>
              <address class="author">by<span> machadogj</span><br>on 
                <time datetime="2011-05-02T11:29" pubdate>02.05.2011 11:29</time>
              </address>
            </div>
          </header>
          <div class="content"><p>First of all, you might be wondering why would I create a REST service with MVC when I can use WCF 4.0, WCF Starter Kit Preview 2 (deprecated), or even the new WCF Web APIs. The short answer is, because websites are, in practice, RESTful. So MVC has some interesting built in support for REST. So when thinking about MVC as a framework for REST services, we could actually ask ourselves “why not?”. As for the rest of the frameworks, each of them have also good reasons to be used, and I would say that you should use which ever fits best for your particular scenario.</p> <p>Having said that, we must not overlook the fact that MVC has been released for websites (primarily), and as such we have excellent support for UI stuff, and we lack some support for other stuff we might need when building services. The lack of support for content negotiation, and media type based serialization is what I will discuss in this post.</p> <h3>Formatters</h3> <p>For the following snipets, I will be using this very simple interface for serializing/deserializing based on a content-type.</p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:aad7d75f-d853-4d39-a2f3-f99cc1680af0" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">interface</span> <span style="color:#2b91af;">IFormatter</span></li> <li style="background:#f3f3f3;">{</li> <li> <span style="color:#0000ff;">bool</span> CanHandle(<span style="color:#0000ff;">string</span> contentType);</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">string</span> Write(<span style="color:#0000ff;">object</span> data);</li> <li> <span style="color:#0000ff;">object</span> Read(<span style="color:#2b91af;">Type</span> type, System.IO.<span style="color:#2b91af;">Stream</span> stream);</li> <li style="background:#f3f3f3;">}</li> </ol> </div> </div> </div> <h3>Deserializing based on content type</h3> <p>Let’s look at one example</p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:877eccaf-d7d6-459d-949f-19cd5a142931" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li>[<span style="color:#2b91af;">HttpPost</span>]</li> <li style="background:#f3f3f3;"><span style="color:#0000ff;">public</span> <span style="color:#2b91af;">ActionResult</span> Create(<span style="color:#0000ff;">int</span> id, <span style="color:#2b91af;">Order</span> order)</li> <li>{</li> <li style="background:#f3f3f3;"> order.Id = id;</li> <li> <span style="color:#0000ff;">return</span> View(order);</li> <li style="background:#f3f3f3;">}</li> </ol> </div> </div> </div> <p>MVC will not deserialize parameters based on the content-type header of the HTTP request. This means that if we want to send an HTTP request with content-type “application/xml” and send an XML representation of the order, MVC will not know what to do with it. On the other hand, we must take into account, that the id parameter will most likely be bound to a Uri parameter using the routing service, and we don’t want to mess that up.</p> <p>Another thing we don’t want to overlook, is the fact that when deserializing the body, we can only deserialize one parameter, the rest should come through other means (uri, headers, cookies, etc).</p> <p>MVC does give us some interesting extensibility points where to accomplish this. When trying to deserialize the body of the request, we could use the help of a model binder. Each parameter of your Controller method, is a Model in MVC. And every model is “binded” (deserialized) using a Model binder. The most common binder we usually use (probably wihout knowing) is a binder which binds the parameters using the requested Uri based on the registered routes. Model binders in MVC are registered on the Global.asax file using the ModelBinders.Binders collection. One of the annoying things about registering a new IModelBinder is that you must register a type for which this binder will be used. This is not ideal, since in our case, we want to deserialize whatever we have in the body.</p> <p><a href="http://machadogj.com/wp-content/uploads/2011/05/image.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="image" border="0" alt="image" src="http://machadogj.com/wp-content/uploads/2011/05/image_thumb.png" width="644" height="115" /></a> </p> <p>The other alternative we have is to add a CustomModelBinderAttribute on each attribute we want to deserialize using our media type based binder (take a look at this <a href="http://gregbeech.com/blog/deserializing-the-request-body-into-a-parameter-with-asp-net-mvc" target="_blank">post</a> for this approach).</p> <h3>MediaTypeBinder</h3> <p>In my case, I only want to use two types of parameters, Uri parameters based on routes, and the body parameter (when POSTing or PUTing). This means I will take a slightly different approach and assume that if the parameter is not in the route data, then it must come from the body. The easiest way to create a binder that is not associated to any particular type, and without loosing the out of the box binding functionality, is to inherit from DefaultModelBinder, and register our custom binder as the default. The code is very simple and uses the content-type header in the request to pick a formatter and do the deserialization.</p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:64ea27a6-fdff-4768-9807-69122a922092" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">MediaTypeBinder</span> : <span style="color:#2b91af;">DefaultModelBinder</span></li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">private</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">readonly</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IFormatter</span>&gt; _formatters = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IFormatter</span>&gt;();</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> DefaultType { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> MediaTypeBinder()</li> <li style="background:#f3f3f3;"> {</li> <li> _formatters.Add(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">XmlFormatter</span>());</li> <li style="background:#f3f3f3;"> _formatters.Add(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">JsonFormatter</span>());</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#2b91af;">MediaTypeBinder</span> RegisterFormatter(<span style="color:#2b91af;">IFormatter</span> formatter)</li> <li style="background:#f3f3f3;"> {</li> <li> _formatters.Add(formatter);</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> <span style="color:#0000ff;">this</span>;</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">object</span> BindModel(<span style="color:#2b91af;">ControllerContext</span> controllerContext, <span style="color:#2b91af;">ModelBindingContext</span> bindingContext)</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">if</span> (controllerContext.RouteData.Values.Keys.Contains(bindingContext.ModelName))</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">return</span> <span style="color:#0000ff;">base</span>.BindModel(controllerContext, bindingContext);</li> <li style="background:#f3f3f3;"> }</li> <li> <span style="color:#0000ff;">else</span></li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">return</span> BindModel(controllerContext.HttpContext.Request.ContentType,</li> <li style="background:#f3f3f3;"> controllerContext.HttpContext.Request.InputStream,</li> <li> bindingContext.ModelType);</li> <li style="background:#f3f3f3;"> }</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">private</span> <span style="color:#0000ff;">object</span> BindModel(<span style="color:#0000ff;">string</span> contentType, System.IO.<span style="color:#2b91af;">Stream</span> stream, <span style="color:#2b91af;">Type</span> type)</li> <li style="background:#f3f3f3;"> {</li> <li> contentType = <span style="color:#0000ff;">string</span>.IsNullOrWhiteSpace(contentType) ? DefaultType : contentType;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">var</span> formatter = _formatters.FirstOrDefault(f =&gt; f.CanHandle(contentType));</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">if</span> (formatter == <span style="color:#0000ff;">null</span>)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">throw</span> <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">InvalidOperationException</span>(<span style="color:#a31515;">&quot;Content type not supported.&quot;</span>);</li> <li> }</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">else</span></li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> formatter.Read(type, stream);</li> <li> }</li> <li style="background:#f3f3f3;"> }</li> <li> }</li> </ol> </div> </div> </div> <p>If the parameter is in the routed data, then we use the default binder. If it’s not, we use the right formatter based on the content type.</p> <h3>Serializing based on Accept header</h3> <p>Another thing about MVC is that it will pick up the right view for you and render the response using that view. In our case, we don’t need a conventional view, but rather a serialization of the response. This can be done using another extensibility point from MVC called ActionFilters. Action filters are attributes with which you can decorate the methods you want, or which you can register globally to run in every request. Action filters run before and after the controller action is invoked, so you can intercept the View that the controller returned, and perform your serialization on the View’s model.</p> <p>The code is very similar to the Binder, except this time we are looking in the HTTP accept header for serialization.</p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:818b1ccd-2fc6-4165-8e62-e7c9ed3af6d5" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">MediaTypeFilter</span> : <span style="color:#2b91af;">ActionFilterAttribute</span></li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">private</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">readonly</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IFormatter</span>&gt; _formatters = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">IFormatter</span>&gt;();</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> DefaultType { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#008000;">// for deserialization</span></li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> MediaTypeFilter()</li> <li> {</li> <li style="background:#f3f3f3;"> _formatters.Add(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">XmlFormatter</span>());</li> <li> _formatters.Add(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">JsonFormatter</span>());</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#2b91af;">MediaTypeFilter</span> RegisterFormatter(Formatters.<span style="color:#2b91af;">IFormatter</span> formatter)</li> <li> {</li> <li style="background:#f3f3f3;"> _formatters.Add(formatter);</li> <li> <span style="color:#0000ff;">return</span> <span style="color:#0000ff;">this</span>;</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">void</span> OnActionExecuted(<span style="color:#2b91af;">ActionExecutedContext</span> filterContext)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">if</span> (!(filterContext.Result <span style="color:#0000ff;">is</span> <span style="color:#2b91af;">ViewResult</span>)) <span style="color:#0000ff;">return</span>;</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">var</span> utf8 = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">UTF8Encoding</span>(<span style="color:#0000ff;">false</span>);</li> <li> <span style="color:#0000ff;">var</span> data = ((<span style="color:#2b91af;">ViewResult</span>)filterContext.Result).ViewData.Model;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">var</span> acceptedTypes = filterContext.RequestContext.HttpContext.Request.AcceptTypes ?? <span style="color:#0000ff;">new</span> <span style="color:#0000ff;">string</span>[0];</li> <li> </li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">string</span> contentType = DefaultType;</li> <li> <span style="color:#0000ff;">var</span> formatter = GetFormatter(acceptedTypes, <span style="color:#0000ff;">ref</span> contentType);</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> filterContext.Result = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">ContentResult</span></li> <li style="background:#f3f3f3;"> {</li> <li> ContentType = contentType,</li> <li style="background:#f3f3f3;"> Content = formatter.Write(data),</li> <li> ContentEncoding = utf8</li> <li style="background:#f3f3f3;"> };</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">private</span> <span style="color:#2b91af;">IFormatter</span> GetFormatter(<span style="color:#0000ff;">string</span>[] acceptedTypes, <span style="color:#0000ff;">ref</span> <span style="color:#0000ff;">string</span> contentType)</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">if</span> (!acceptedTypes.Any())</li> <li style="background:#f3f3f3;"> {</li> <li> acceptedTypes = <span style="color:#0000ff;">new</span>[] { DefaultType };</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#2b91af;">IFormatter</span> formatter;</li> <li> <span style="color:#008000;">//pick the first formatter that can handle any accepted type.</span></li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">var</span> formatterMatch = _formatters</li> <li> .SelectMany(_ =&gt; acceptedTypes, (x, y) =&gt; <span style="color:#0000ff;">new</span> { Formatter = x, ContentType = y })</li> <li style="background:#f3f3f3;"> .FirstOrDefault(x =&gt; x.Formatter.CanHandle(x.ContentType));</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">if</span> (formatterMatch != <span style="color:#0000ff;">null</span>)</li> <li> {</li> <li style="background:#f3f3f3;"> formatter = formatterMatch.Formatter;</li> <li> contentType = formatterMatch.ContentType;</li> <li style="background:#f3f3f3;"> }</li> <li> <span style="color:#0000ff;">else</span></li> <li style="background:#f3f3f3;"> {</li> <li> formatter = GetDefaultFormatter();</li> <li style="background:#f3f3f3;"> }</li> <li> <span style="color:#0000ff;">return</span> formatter;</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">private</span> <span style="color:#2b91af;">IFormatter</span> GetDefaultFormatter()</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> _formatters.First(f =&gt; f.CanHandle(DefaultType));</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">void</span> OnActionExecuting(<span style="color:#2b91af;">ActionExecutingContext</span> filterContext)</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#008000;">//do nothing. deserialization is being handled in the MediaTypeBinder.</span></li> <li style="background:#f3f3f3;"> }</li> <li> }</li> </ol> </div> </div> </div> <p>Just so that you can have the entire implementation, I leave you the Xml and Json formatters.</p> <p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:2dc1ef10-d1c4-41f8-8ada-586868fac986" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">JsonFormatter</span> : <span style="color:#2b91af;">IFormatter</span></li> <li style="background:#f3f3f3;">{</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> CanHandle(<span style="color:#0000ff;">string</span> contentType)</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">return</span> contentType.EndsWith(<span style="color:#a31515;">&quot;/json&quot;</span>);</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> Write(<span style="color:#0000ff;">object</span> data)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">if</span> (data == <span style="color:#0000ff;">null</span>)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> <span style="color:#a31515;">&quot;{}&quot;</span>;</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">using</span> (<span style="color:#0000ff;">var</span> stream = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">MemoryStream</span>())</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#2b91af;">JavaScriptSerializer</span> js = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">JavaScriptSerializer</span>();</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> js.Serialize(data);</li> <li> }</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">object</span> Read(<span style="color:#2b91af;">Type</span> type, <span style="color:#2b91af;">Stream</span> stream)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">JavaScriptSerializer</span>().Deserialize(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">StreamReader</span>(stream).ReadToEnd(), type);</li> <li> }</li> <li style="background:#f3f3f3;">}</li> </ol> </div> </div> </div> </p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:c0cd913b-5888-4d87-991e-20c11ed7cf9d" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">XmlFormatter</span> : <span style="color:#2b91af;">IFormatter</span></li> <li style="background:#f3f3f3;">{</li> <li> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> CanHandle(<span style="color:#0000ff;">string</span> contentType)</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">return</span> contentType.EndsWith(<span style="color:#a31515;">&quot;/xml&quot;</span>);</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> Write(<span style="color:#0000ff;">object</span> data)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#2b91af;">UTF8Encoding</span> utf8 = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">UTF8Encoding</span>(<span style="color:#0000ff;">false</span>);</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">if</span> (data == <span style="color:#0000ff;">null</span>)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> <span style="color:#a31515;">&quot;&quot;</span>;</li> <li> }</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#0000ff;">using</span> (<span style="color:#2b91af;">MemoryStream</span> stream = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">MemoryStream</span>())</li> <li style="background:#f3f3f3;"> {</li> <li> <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">XmlSerializer</span>(data.GetType(), <span style="color:#a31515;">&quot;&quot;</span>).Serialize(stream, data);</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> utf8.GetString(stream.ToArray());</li> <li> }</li> <li style="background:#f3f3f3;"> }</li> <li>&nbsp;</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">object</span> Read(<span style="color:#2b91af;">Type</span> type, <span style="color:#2b91af;">Stream</span> stream)</li> <li> {</li> <li style="background:#f3f3f3;"> <span style="color:#0000ff;">return</span> <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">XmlSerializer</span>(type).Deserialize(stream);</li> <li> }</li> <li style="background:#f3f3f3;">}</li> </ol> </div> </div> </div> <p>Here’s how to set it up in the Global.asax.cs file.</p> <div style="display:inline;float:none;margin:0;padding:0;" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:c2a66274-c1ba-4c72-b0e4-cad17816c697" class="wlWriterEditableSmartContent"> <div style="border:#000080 1px solid;color:#000;font-family:'Courier New', Courier, Monospace;font-size:10pt;"> <div style="background:#000080;color:#fff;font-family:Verdana, Tahoma, Arial, sans-serif;font-weight:bold;padding:2px 5px;">Code Snippet</div> <div style="background:#fff;max-height:300px;overflow:auto;"> <ol style="background:#ffffff;margin:0;padding:0 0 0 5px;"> <li><span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">void</span> Application_Start()</li> <li style="background:#f3f3f3;">{</li> <li> RegisterRoutes(<span style="color:#2b91af;">RouteTable</span>.Routes);</li> <li style="background:#f3f3f3;">&nbsp;</li> <li> <span style="color:#2b91af;">GlobalFilters</span>.Filters.Add(<span style="color:#0000ff;">new</span> <span style="color:#2b91af;">MediaTypeBinder</span> { DefaultType = <span style="color:#a31515;">&quot;text/xml&quot;</span> });</li> <li style="background:#f3f3f3;"> <span style="color:#2b91af;">ModelBinders</span>.Binders.DefaultBinder = <span style="color:#0000ff;">new</span> <span style="color:#2b91af;">MediaTypeBinder</span>();</li> <li>}</li> </ol> </div> </div> </div> <p></p> <p></p> <p>So know you can make your controller actions media-type agnostic, and let something else worry about how to handle serialization.</p></div>
        </article>
        <div class="span4">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Latest Posts</li>
              <li><a href="/2012/4/stylus-a-better-css.html">Stylus, a better CSS</a></li>
              <li><a href="/2012/4/getting-started-with-express-for-node-js.html">Getting started with Express for node.js</a></li>
              <li><a href="/2012/4/getting-started-with-node-js.html">Getting started with node.js</a></li>
              <li><a href="/2012/0/unit-testing-and-test-driven-development-lessons-learned.html">Unit Testing and Test Driven Development (Lessons Learned)</a></li>
              <li><a href="/2011/9/unit-testing-wit-knockout-js-with-tdd.html">Unit Testing with Knockout.js</a></li>
              <li><a href="/archive.html">See more >></a></li>
            </ul>
          </div>
        </div>
      </div>
      <hr>copyright 2012 <a href="http://machadogj.com">machadogj.com</a> by <a href="http://twitter.com/machadogj">@machadogj</a><br><br>
    </div>
    <script src="/js/bootstrap.js"></script>
  </body>
</html>