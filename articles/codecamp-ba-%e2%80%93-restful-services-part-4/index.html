<h1>ASP .NET MVC</h1>
In this post we will see how we can apply REST in ASP .NET MVC pages. And even though websites are REST applications, they expose representation of resources (html files); and that they handle various HTTP Verbs, with MVC you can also expose resources like json, xml, atom, etc. What’s even more, you can return an html representation or a json representation depending on the HTTP headers.
<h2>MVC</h2>
MVC stands for Model View Controller, and basically what this means is that we should model our business in a Model layer, and then act upon user requests in our Controller layer returning the corresponding View that will be rendered to the user. As for our Model, we will think of it as our business logic, and in this example, we will have two entities: Contacts and Locations. One contact resides in one location, and our locations will hold multiple contacts.
We want our MVC web page to do is handle two scenarios, the possibility to see a list of Locations and the possibility to edit a contact (and the contact’s location). The first one is easy, and it’s just as you would do any other webpage in MVC. We would have controller for locations:
<pre><code><span style="color:#800000;font-weight:bold;">public</span> <span style="color:#800000;font-weight:bold;">class</span> LocationsController <span style="color:#808030;">:</span> Controller
    <span style="color:#800080;">{</span>

        <span style="color:#800000;font-weight:bold;">public</span> Models<span style="color:#808030;">.</span>ContactsModel Model <span style="color:#800080;">{</span> get<span style="color:#800080;">;</span> <span style="color:#800000;font-weight:bold;">private</span> set<span style="color:#800080;">;</span> <span style="color:#800080;">}</span>

        <span style="color:#800000;font-weight:bold;">public</span> LocationsController<span style="color:#808030;">(</span><span style="color:#808030;">)</span>
        <span style="color:#800080;">{</span>
            Model <span style="color:#808030;">=</span> <span style="color:#800000;font-weight:bold;">new</span> Models<span style="color:#808030;">.</span>ContactsModel<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
        <span style="color:#800080;">}</span>

        <span style="color:#696969;">// GET: /Locations/</span>
        <span style="color:#800000;font-weight:bold;">public</span> ActionResult Index<span style="color:#808030;">(</span><span style="color:#808030;">)</span>
        <span style="color:#800080;">{</span>
            var locations <span style="color:#808030;">=</span> Model<span style="color:#808030;">.</span>GetLocations<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#808030;">.</span>ToList<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
                <span style="color:#800000;font-weight:bold;">return</span> View<span style="color:#808030;">(</span>locations<span style="color:#808030;">)</span><span style="color:#800080;">;</span>
        <span style="color:#800080;">}</span>

    <span style="color:#800080;">}</span>
</code></pre>
Notice that the Index() method will return a View that holds a list of the locations. Here could be such a view:
<pre><code><span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;">@ Page Title</span><span style="color:#808030;background:#ffffe8;">=</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;"> Language</span><span style="color:#808030;background:#ffffe8;">=</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;">C#</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;"> MasterPageFile</span><span style="color:#808030;background:#ffffe8;">=</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;">~/Views/Shared/Site.Master</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;"> Inherits</span><span style="color:#808030;background:#ffffe8;">=</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;">System.Web.Mvc.ViewPage&lt;IEnumerable&lt;Directory.Website.DirectoryService.Location&gt;&gt;</span><span style="color:#808030;background:#ffffe8;">"</span><span style="color:#000000;background:#ffffe8;"> </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span>
<span style="color:#a65700;">&lt;</span><span style="color:#5f5035;">asp:Content</span><span style="color:#274796;"> </span><span style="color:#074726;">ID</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"Content1"</span><span style="color:#274796;"> ContentPlaceHolderID</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"TitleContent"</span><span style="color:#274796;"> runat</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"server"</span><span style="color:#a65700;">&gt;</span>
    Locations
<span style="color:#a65700;">&lt;/</span><span style="color:#5f5035;">asp:Content</span><span style="color:#a65700;">&gt;</span>
<span style="color:#a65700;">&lt;</span><span style="color:#5f5035;">asp:Content</span><span style="color:#274796;"> </span><span style="color:#074726;">ID</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"Content2"</span><span style="color:#274796;"> ContentPlaceHolderID</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"MainContent"</span><span style="color:#274796;"> runat</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"server"</span><span style="color:#a65700;">&gt;</span>
    <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">h2</span><span style="color:#a65700;">&gt;</span>Locations<span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">h2</span><span style="color:#a65700;">&gt;</span>
    <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">table</span><span style="color:#a65700;">&gt;</span>
        <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">tr</span><span style="color:#a65700;">&gt;</span>
            <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">th</span><span style="color:#a65700;">&gt;</span>Id<span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">th</span><span style="color:#a65700;">&gt;</span>
            <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">th</span><span style="color:#a65700;">&gt;</span>Name<span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">th</span><span style="color:#a65700;">&gt;</span>
        <span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">tr</span><span style="color:#a65700;">&gt;</span>
    <span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;"> foreach </span><span style="color:#808030;background:#ffffe8;">(</span><span style="color:#000000;background:#ffffe8;">var item </span><span style="color:#800000;background:#ffffe8;font-weight:bold;">in</span><span style="color:#000000;background:#ffffe8;"> Model</span><span style="color:#808030;background:#ffffe8;">)</span><span style="color:#000000;background:#ffffe8;"> { </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span>
        <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">tr</span><span style="color:#a65700;">&gt;</span>
            <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">td</span><span style="color:#a65700;">&gt;</span><span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;">: item</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">Id </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span><span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">td</span><span style="color:#a65700;">&gt;</span>
            <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">td</span><span style="color:#a65700;">&gt;</span><span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;">: item</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">Name </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span><span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">td</span><span style="color:#a65700;">&gt;</span>
        <span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">tr</span><span style="color:#a65700;">&gt;</span>
    <span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;"> } </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span>
    <span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">table</span><span style="color:#a65700;">&gt;</span>
<span style="color:#a65700;">&lt;/</span><span style="color:#5f5035;">asp:Content</span><span style="color:#a65700;">&gt;</span>
</code></pre>
Nothing special so far, but in the second scenario it will get more interesting.  Now, I need an Edit Contact form that will present the locations as a dropdown list to the user. The user will be able to choose the location and then save the changes on the Contact. Clearly, the controller will be a ContactsController where we are going to return a view with the contact information. But as for the Locations, we might be able to use our LocationsController if we wanted to load the dropdown list through AJAX. In that case we need the website to return a json with the list of locations. As for contact view, here is how we could render the location field:
<pre><code><span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">div</span><span style="color:#274796;"> </span><span style="color:#074726;">class</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"editor-field"</span><span style="color:#a65700;">&gt;</span>
                <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">select</span><span style="color:#274796;"> </span><span style="color:#074726;">id</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"LocationID"</span><span style="color:#274796;"> </span><span style="color:#074726;">name</span><span style="color:#808030;">=</span><span style="color:#0000e6;">"LocationId"</span><span style="color:#a65700;">&gt;</span><span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">select</span><span style="color:#a65700;">&gt;</span>
                <span style="color:#a65700;">&lt;</span><span style="color:#800000;font-weight:bold;">script language="</span><span style="color:#0000e6;">javascript</span><span style="color:#800000;font-weight:bold;">" type="text/javascript"</span><span style="color:#a65700;">&gt;</span>
                    $<span style="color:#808030;">.</span>getJSON<span style="color:#808030;">(</span><span style="color:#0000e6;">"Locations"</span><span style="color:#808030;">,</span> <span style="color:#800000;font-weight:bold;">function</span> <span style="color:#808030;">(</span>data<span style="color:#808030;">)</span> <span style="color:#800080;">{</span>
                        <span style="color:#800000;font-weight:bold;">var</span> items <span style="color:#808030;">=</span> <span style="color:#0000e6;">"&lt;option selected&gt;&lt;/option&gt;"</span><span style="color:#800080;">;</span>
                        $<span style="color:#808030;">.</span>each<span style="color:#808030;">(</span>data<span style="color:#808030;">,</span> <span style="color:#800000;font-weight:bold;">function</span> <span style="color:#808030;">(</span>i<span style="color:#808030;">,</span> <span style="color:#800000;font-weight:bold;">item</span><span style="color:#808030;">)</span> <span style="color:#800080;">{</span>
                            items <span style="color:#808030;">+=</span> <span style="color:#0000e6;">"&lt;option value='"</span> <span style="color:#808030;">+</span> <span style="color:#800000;font-weight:bold;">item</span><span style="color:#808030;">.</span>Value <span style="color:#808030;">+</span> <span style="color:#0000e6;">"'&gt;"</span> <span style="color:#808030;">+</span> <span style="color:#800000;font-weight:bold;">item</span><span style="color:#808030;">.</span>Text <span style="color:#808030;">+</span> <span style="color:#0000e6;">"&lt;/option&gt;"</span><span style="color:#800080;">;</span>
                        <span style="color:#800080;">}</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
                        $<span style="color:#808030;">(</span><span style="color:#0000e6;">"#LocationID"</span><span style="color:#808030;">)</span><span style="color:#808030;">.</span>html<span style="color:#808030;">(</span>items<span style="color:#808030;">)</span><span style="color:#800080;">;</span>
                        $<span style="color:#808030;">(</span><span style="color:#0000e6;">"#LocationID"</span><span style="color:#808030;">)</span><span style="color:#808030;">.</span>val<span style="color:#808030;">(</span><span style="color:#0000e6;">'</span><span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;">: Model</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">Location</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">Id</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">ToString</span><span style="color:#808030;background:#ffffe8;">(</span><span style="color:#808030;background:#ffffe8;">)</span><span style="color:#000000;background:#ffffe8;"> </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span><span style="color:#0000e6;">'</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
                    <span style="color:#800080;">}</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
                <span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">script</span><span style="color:#a65700;">&gt;</span>
                <span style="color:#a65700;background:#ffffe8;">&lt;%</span><span style="color:#000000;background:#ffffe8;">: Html</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">ValidationMessageFor</span><span style="color:#808030;background:#ffffe8;">(</span><span style="color:#000000;background:#ffffe8;">model </span><span style="color:#808030;background:#ffffe8;">=</span><span style="color:#808030;background:#ffffe8;">&gt;</span><span style="color:#000000;background:#ffffe8;"> model</span><span style="color:#008c00;background:#ffffe8;">.</span><span style="color:#000000;background:#ffffe8;">LocationId</span><span style="color:#808030;background:#ffffe8;">)</span><span style="color:#000000;background:#ffffe8;"> </span><span style="color:#a65700;background:#ffffe8;">%&gt;</span>
            <span style="color:#a65700;">&lt;/</span><span style="color:#800000;font-weight:bold;">div</span><span style="color:#a65700;">&gt;</span>
</code></pre>
Basically, we request a json to the server, and then build all the options of the dropdown list, and finally, we set the contact’s current location with the .val(..);
But now we need to handle the case where the LocationsController needs to return the json response. Here’s how we do that:
<pre><code><span style="color:#800000;font-weight:bold;">public</span> ActionResult Index<span style="color:#808030;">(</span><span style="color:#808030;">)</span>
        <span style="color:#800080;">{</span>
            var locations <span style="color:#808030;">=</span> Model<span style="color:#808030;">.</span>GetLocations<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#808030;">.</span>ToList<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#800080;">;</span>
            <span style="color:#800000;font-weight:bold;">if</span> <span style="color:#808030;">(</span><span style="color:#808030;">!</span>HttpContext<span style="color:#808030;">.</span>Request<span style="color:#808030;">.</span>IsAjaxRequest<span style="color:#808030;">(</span><span style="color:#808030;">)</span><span style="color:#808030;">)</span>
                <span style="color:#800000;font-weight:bold;">return</span> View<span style="color:#808030;">(</span>locations<span style="color:#808030;">)</span><span style="color:#800080;">;</span>
            <span style="color:#800000;font-weight:bold;">else</span>
                <span style="color:#800000;font-weight:bold;">return</span> Json<span style="color:#808030;">(</span><span style="color:#800000;font-weight:bold;">new</span> SelectList<span style="color:#808030;">(</span>locations<span style="color:#808030;">,</span> <span style="color:#800000;">"</span><span style="color:#0000e6;">Id</span><span style="color:#800000;">"</span><span style="color:#808030;">,</span> <span style="color:#800000;">"</span><span style="color:#0000e6;">Name</span><span style="color:#800000;">"</span><span style="color:#808030;">)</span><span style="color:#808030;">,</span> JsonRequestBehavior<span style="color:#808030;">.</span>AllowGet<span style="color:#808030;">)</span><span style="color:#800080;">;</span>
        <span style="color:#800080;">}</span>
</code></pre>
The JsonRequestBehavior.AllowGet is just so that you can see the json’s response in the browser.
So that is how you can start exposing not only html content but also json, and other formats in MVC, reusing the Model logic, and the controllers.